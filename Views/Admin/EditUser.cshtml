@model ApplicationUser
@using System.Linq
@{
    ViewData["Title"] = "עריכת משתמש";
    var userRoles = ViewBag.UserRoles as IList<string> ?? new List<string>();
}

<h2><i class="bi bi-pencil"></i> עריכת משתמש: @Model.UserName</h2>
<hr />

@if (ViewData.ModelState.ErrorCount > 0)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <h5><i class="bi bi-exclamation-triangle"></i> שגיאות:</h5>
        <ul class="mb-0">
            @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
            {
                <li>@error.ErrorMessage</li>
            }
        </ul>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<form asp-action="EditUser" method="post">
    @Html.AntiForgeryToken()
    <input type="hidden" name="id" value="@Model.Id" />
    
    <div class="row">
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label class="form-label">שם משתמש <span class="text-danger">*</span></label>
                <input type="text" name="userName" class="form-control" value="@Model.UserName" required />
                <small class="form-text text-muted">שם משתמש ייחודי למערכת</small>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label class="form-label">אימייל <span class="text-danger">*</span></label>
                <input type="email" name="email" class="form-control" value="@Model.Email" required />
                <small class="form-text text-muted">כתובת אימייל תקינה</small>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label class="form-label">סיסמה חדשה</label>
                <input type="password" name="newPassword" class="form-control" minlength="6" />
                <small class="form-text text-muted">השאר ריק כדי לשמור את הסיסמה הנוכחית. לפחות 6 תווים אם משנה</small>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label class="form-label">שם מלא</label>
                <input type="text" name="fullName" class="form-control" value="@Model.FullName" />
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="form-group mb-3">
                <label class="form-label">מחלקה</label>
                <input type="text" name="department" class="form-control" value="@Model.Department" />
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="form-check mb-3">
                <input type="checkbox" name="isManager" class="form-check-input" id="isManager" checked="@Model.IsManager" />
                <label class="form-check-label" for="isManager">
                    מנהל
                </label>
                <small class="form-text text-muted d-block">הגדר משתמש כמנהל</small>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-check mb-3">
                <input type="checkbox" name="isAdmin" class="form-check-input" id="isAdmin" checked="@Model.IsAdmin" />
                <label class="form-check-label" for="isAdmin">
                    מנהל מערכת (Admin)
                </label>
                <small class="form-text text-muted d-block">הגדר משתמש כמנהל מערכת עם הרשאות מלאות</small>
            </div>
        </div>
    </div>

    <div class="alert alert-info">
        <i class="bi bi-info-circle"></i> <strong>תפקידים נוכחיים:</strong>
        @if (userRoles.Any())
        {
            @foreach (var role in userRoles)
            {
                <span class="badge bg-@(role == "Admin" ? "danger" : role == "Manager" ? "warning" : "info")">@role</span>
            }
        }
        else
        {
            <span>אין תפקידים</span>
        }
    </div>

    <div class="form-group">
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-save"></i> שמור שינויים
        </button>
        <a asp-action="Users" class="btn btn-secondary">
            <i class="bi bi-arrow-right"></i> ביטול
        </a>
    </div>
</form>

